; Action list for GFX/HDMI/TVWizard/IIPS

[Variables]
product=Intel(R) Graphics Media Accelerator Driver
installDir=%ProgFilesDir%\Intel\%product%
GFXVer=%getdriverversion(GFX)%
MSDKDEST1=%commonappsdir%\Intel\Media SDK\i1\1.0
MSDKDEST164=%commonappsdir64%\Intel\Media SDK\i1\1.0
MSDKSRC15=%source%\MediaSDK\win32
MSDKSRC1564=%source%\MediaSDK\x64
MSDKDEST15=%commonappsdir%\Intel\Media SDK\i1\1.5
MSDKDEST1564=%commonappsdir64%\Intel\Media SDK\i1\1.5


[Groups]
ARP=NOT IsCmd(noarp)
GFX=NOT IsCmd(nodrv) AND IfDrvExists(GFX)
HDMI=NOT IsCmd(nodrv) AND IfDrvExists(HDMI)
HDMI_HD=NOT IsCmd(nodrv) AND IfDrvExists(HDMI_HD)
MEDIA=IsGroupSel(HDMI_HD) AND IfExists("%source%"\Media\Media.cab) AND IsOS(VISTA,0x060001FF)
IIPS=NOT IsCmd(nodrv) AND IfDrvExists(IIPS)
ICC=NOT IsCmd(noicc)
MSDK1=IsGroupSel(GFX) AND IfExists("%source%"\MediaSDK\libmfxhw32-i1.dll)
MSDK15=IsGroupSel(GFX) AND IfExists("%source%"\MediaSDK\win32\libmfxhw32-i1.dll)


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Setup files             ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[File]
operation=copyonly
mode=overwrite
source=%setup%
destination=%installDir%\uninstall\Setup.exe
sequence=100

[Folder]
operation=copy
mode=overwrite
source=%source%\lang
destination=%installDir%\uninstall
sequence=105

[File]
operation=copy
mode=overwrite
source=%source%\x64\Drv64.exe
destination=%installDir%\uninstall\x64\Drv64.exe
condition=Is64
sequence=110
usequence=11000

[File]
operation=copyonly
mode=ifnewer
source=%source%\difxapi.dll
destination=%system%\difxapi.dll
error=ignore
sequence=115

[File]
operation=copyonly
mode=ifnewer
source=%source%\x64\difxapi.dll
destination=%system64%\difxapi.dll
condition=Is64
error=ignore
sequence=115

[Uninstall]
name={F0E3AD40-2BBD-4360-9C76-B9AC9A5886EA}
display=%product%
display_mui=@%installDir%\Uninstall\Setup.exe,-%PRODUCTNAMERESID%
command=%installDir%\Uninstall\setup.exe -uninstall
location=%installDir%
estimatedsize=76000
publisher=Intel Corporation
icon=%installDir%\Uninstall\Setup.exe,0
modify=no
repair=no
version=%GFXVer%
sequence=120
group=ARP


;;;;;;;;;;;;;;;;;;;;;;;;
; GFX

[inf]
name=GFX
sequence=-5
usequence=1
group=GFX

[Registry]
operation=create
root=HKLM
path=System\CurrentControlSet\Control\Windows
value=SystemDirectory
data=%system%
type=sz
sequence=100
group=GFX

[Registry]
operation=create
root=HKLM
path=System\CurrentControlSet\Services\ialm\Device0
value=SystemDirectory
data=%system%
type=sz
sequence=100
group=GFX

[Registry]
operation=create
root=HKLM
path=System\CurrentControlSet\Services\ialm\Device1
value=SystemDirectory
data=%system%
type=sz
sequence=100
group=GFX

[Registry]
operation=createonly
root=HKLM
path=SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
value=WinSat
data=winsat dwm -xml results.xml
type=sz
condition=IsOS(VISTA,MAXOS) AND NOT IsCmd(nowinsat) AND IfDrvExists(GFX) AND NOT Is64
sequence=100
group=GFX

[Registry]
operation=createonly
hive=64
root=HKLM
path=SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
value=WinSat
data=winsat dwm -xml results.xml
type=sz
condition=IsOS(VISTA,MAXOS) AND NOT IsCmd(nowinsat) AND IfDrvExists(GFX) AND Is64
sequence=100
group=GFX


;;;;;;;;;;;;;;;;;;;;;;;;
; HDMI

[File]
operation=copy
source=%source%\Media\Media.cab
destination=%windir%\Media
decompress=yes
error=ignore
sequence=-4
usequence=1002
group=MEDIA

[inf]
name=HDMI
sequence=-3
usequence=10001
group=HDMI

[inf]
name=HDMI_HD
sequence=-3
usequence=10001
group=HDMI_HD


;;;;;;;;;;;;;;;;;;;;;;;;
; IIPS

[inf]
name=IIPS
sequence=-1
usequence=10000
group=IIPS

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Begin Media SDK

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Media SDK 1                    ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; 32 bit

[File]
operation=copy
mode=overwrite
source=%source%\MediaSDK\libmfxhw32-i1.dll
destination=%MSDKDEST1%\libmfxhw32-i1.dll
sequence=200
usequence=200
group=MSDK1

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=DeviceID
data=x%GFX_HWID%
type=dw
sequence=205
usequence=205
group=MSDK1

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=VendorID
data=x8086
type=dw
sequence=210
usequence=210
group=MSDK1

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=Merit
data=x08000001
type=dw
sequence=215
usequence=215
group=MSDK1

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=APIVersion
data=x0100
type=dw
sequence=220
usequence=220
group=MSDK1

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=Path
data=%MSDKDEST1%\libmfxhw32-i1.dll
type=sz
sequence=225
usequence=225
group=MSDK1

; 64 bit

[File]
operation=copy
mode=overwrite
source=%source%\MediaSDK\libmfxhw64-i1.dll
destination=%MSDKDEST164%\libmfxhw64-i1.dll
condition=Is64
sequence=400
usequence=400
group=MSDK1

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=DeviceID
data=x%GFX_HWID%
type=dw
condition=Is64
sequence=405
usequence=405
group=MSDK1

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=VendorID
data=x8086
type=dw
condition=Is64
sequence=410
usequence=410
group=MSDK1

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=Merit
data=x08000001
type=dw
condition=Is64
sequence=415
usequence=415
group=MSDK1

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=APIVersion
data=x0100
type=dw
condition=Is64
sequence=420
usequence=420
group=MSDK1

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=Path
data=%MSDKDEST164%\libmfxhw64-i1.dll
type=sz
condition=Is64
sequence=425
usequence=425
group=MSDK1


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; These actions run on uninstall ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[Registry]
operation=deleteonuninstall
root=HKLM
path=SOFTWARE\Intel\MediaSDK
delete_if_not_empty=no
usequence=230
group=MSDK1

;; 64 bit uninstall stuff

[Registry]
operation=deleteonuninstall
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK
delete_if_not_empty=no
condition=Is64
usequence=430
group=MSDK1


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Media SDK 1.5                  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; 1.5 32 bit install

; Copy all files on Win7+
[Folder]
operation=copy
mode=overwrite
source=%MSDKSRC15%
destination=%MSDKDEST15%
sequence=200
usequence=310
condition=IsOS(WIN7,MAXOS)
group=MSDK15

; On Vista copy main DLL only
[File]
operation=copy
mode=overwrite
source=%MSDKSRC15%\libmfxhw32-i1.dll
destination=%MSDKDEST15%\libmfxhw32-i1.dll
sequence=200
usequence=310
condition=IsOS(1,0x060001FF)
group=MSDK15

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=DeviceID
data=x%GFX_HWID%
type=dw
sequence=260
usequence=250
group=MSDK15

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=VendorID
data=x8086
type=dw
sequence=265
usequence=245
group=MSDK15

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=Merit
data=x%MSDK_MERIT%
type=dw
sequence=270
usequence=240
group=MSDK15

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=Path
data=%MSDKDEST15%\libmfxhw32-i1.dll
type=sz
sequence=275
usequence=235
group=MSDK15

[Registry]
operation=create
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
value=APIVersion
data=x%MSDK_APIVERSION%
type=dw
sequence=280
usequence=230
group=MSDK15

[Registry]
operation=createonly
root=HKLM
path=SOFTWARE\Microsoft\Windows Media Foundation\HardwareMFT
value=EnableDecoders
data=x1
type=dw
condition=IsOS(WIN7,MAXOS)
sequence=285
usequence=225
group=MSDK15

[Registry]
operation=createonly
root=HKLM
path=SOFTWARE\Microsoft\Windows Media Foundation\HardwareMFT
value=EnableVideoProcessors
data=x1
type=dw
condition=IsOS(WIN7,MAXOS)
sequence=290
usequence=220
group=MSDK15

[RegisterCOM]
operation=reg
bin=%MSDKDEST15%\mfx_mft_h264vd_32.dll
condition=IsOS(WIN7,MAXOS)
sequence=295
usequence=215
group=MSDK15

[RegisterCOM]
operation=reg
bin=%MSDKDEST15%\mfx_mft_mp2vd_32.dll
condition=IsOS(WIN7,MAXOS)
sequence=300
usequence=210
group=MSDK15

[RegisterCOM]
operation=reg
bin=%MSDKDEST15%\mfx_mft_vc1vd_32.dll
condition=IsOS(WIN7,MAXOS)
sequence=305
usequence=205
group=MSDK15

[RegisterCOM]
operation=reg
bin=%MSDKDEST15%\mfx_mft_vpp_32.dll
condition=IsOS(WIN7,MAXOS)
sequence=310
usequence=200
group=MSDK15

; Remove SDK1.0 if it's installed
[Folder]
operation=deleteoninstall
destination=%MSDKDEST1%
delete_if_not_empty=yes
sequence=315
group=MSDK15


; 1.5 32bit uninstall

[Folder]
operation=deleteonuninstall
destination=%MSDKDEST15%
delete_if_not_empty=yes
usequence=320
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%commonappsdir%\Intel\Media SDK\i1
delete_if_not_empty=no
usequence=325
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%commonappsdir%\Intel\Media SDK
delete_if_not_empty=no
usequence=330
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%commonappsdir%\Intel
delete_if_not_empty=no
usequence=335
group=MSDK15

[Registry]
operation=deleteonuninstall
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw32-i1-1
delete_if_not_empty=no
usequence=340
group=MSDK15

[Registry]
operation=deleteonuninstall
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch
delete_if_not_empty=no
usequence=345
group=MSDK15

[Registry]
operation=deleteonuninstall
root=HKLM
path=SOFTWARE\Intel\MediaSDK
delete_if_not_empty=no
usequence=350
group=MSDK15

[Registry]
operation=deleteonuninstall
root=HKLM
path=SOFTWARE\Intel
delete_if_not_empty=no
usequence=355
group=MSDK15


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; 64 bit

; 1.5 64 bit install

; Copy all files on Win7+
[Folder]
operation=copy
mode=overwrite
source=%MSDKSRC1564%
destination=%MSDKDEST1564%
sequence=400
usequence=510
condition=Is64 AND IsOS(WIN7,MAXOS)
group=MSDK15

; On Vista copy main DLL only
[File]
operation=copy
mode=overwrite
source=%MSDKSRC1564%\libmfxhw64-i1.dll
destination=%MSDKDEST1564%\libmfxhw64-i1.dll
sequence=400
usequence=510
condition=Is64 AND IsOS(1,0x060001FF)
group=MSDK15

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=DeviceID
data=x%GFX_HWID%
type=dw
condition=Is64
sequence=460
usequence=450
group=MSDK15

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=VendorID
data=x8086
type=dw
condition=Is64
sequence=465
usequence=445
group=MSDK15

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=Merit
data=x%MSDK_MERIT%
type=dw
condition=Is64
sequence=470
usequence=440
group=MSDK15

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=Path
data=%MSDKDEST1564%\libmfxhw64-i1.dll
type=sz
condition=Is64
sequence=475
usequence=435
group=MSDK15

[Registry]
operation=create
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
value=APIVersion
data=x%MSDK_APIVERSION%
type=dw
condition=Is64
sequence=480
usequence=430
group=MSDK15

[Registry]
operation=createonly
hive=64
root=HKLM
path=SOFTWARE\Microsoft\Windows Media Foundation\HardwareMFT
value=EnableDecoders
data=x1
type=dw
condition=Is64 AND IsOS(WIN7,MAXOS)
sequence=485
usequence=425
group=MSDK15

[Registry]
operation=createonly
hive=64
root=HKLM
path=SOFTWARE\Microsoft\Windows Media Foundation\HardwareMFT
value=EnableVideoProcessors
data=x1
type=dw
condition=Is64 AND IsOS(WIN7,MAXOS)
sequence=490
usequence=420
group=MSDK15

[Process]
operation=runonly
bin=%system64%\regsvr32.exe
commandline=/s "%MSDKDEST1564%\mfx_mft_h264vd_64.dll"
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
sequence=495
group=MSDK15

[Process]
operation=runonly
bin=%system64%\regsvr32.exe
commandline=/s "%MSDKDEST1564%\mfx_mft_mp2vd_64.dll"
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
sequence=500
group=MSDK15

[Process]
operation=runonly
bin=%system64%\regsvr32.exe
commandline=/s "%MSDKDEST1564%\mfx_mft_vc1vd_64.dll"
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
sequence=505
group=MSDK15

[Process]
operation=runonly
bin=%system64%\regsvr32.exe
commandline=/s "%MSDKDEST1564%\mfx_mft_vpp_64.dll"
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
sequence=510
group=MSDK15

; Remove SDK1.0 if it's installed
[Folder]
operation=deleteoninstall
destination=%MSDKDEST164%
delete_if_not_empty=yes
condition=Is64
sequence=515
group=MSDK15


; 1.5 64 bit uninstall

[Process]
operation=runonuninstall
bin=%system64%\regsvr32.exe
commandline=/s /u %MSDKDEST1564%\mfx_mft_h264vd_64.dll
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
usequence=451
group=MSDK15

[Process]
operation=runonuninstall
bin=%system64%\regsvr32.exe
commandline=/s /u %MSDKDEST1564%\mfx_mft_mp2vd_64.dll
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
usequence=452
group=MSDK15

[Process]
operation=runonuninstall
bin=%system64%\regsvr32.exe
commandline=/s /u %MSDKDEST1564%\mfx_mft_vc1vd_64.dll
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
usequence=453
group=MSDK15

[Process]
operation=runonuninstall
bin=%system64%\regsvr32.exe
commandline=/s /u %MSDKDEST1564%\mfx_mft_vpp_64.dll
wait=yes
condition=Is64 AND IsOS(WIN7,MAXOS)
usequence=454
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%MSDKDEST1564%
delete_if_not_empty=yes
condition=Is64
usequence=519
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%commonappsdir64%\Intel\Media SDK\i1
delete_if_not_empty=no
condition=Is64
usequence=520
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%commonappsdir64%\Intel\Media SDK
delete_if_not_empty=no
condition=Is64
usequence=525
group=MSDK15

[Folder]
operation=deleteonuninstall
destination=%commonappsdir64%\Intel
delete_if_not_empty=no
condition=Is64
usequence=530
group=MSDK15

[Registry]
operation=deleteonuninstall
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch\hw64-i1-1
delete_if_not_empty=no
condition=Is64
usequence=535
group=MSDK15

[Registry]
operation=deleteonuninstall
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK\Dispatch
delete_if_not_empty=no
condition=Is64
usequence=540
group=MSDK15

[Registry]
operation=deleteonuninstall
hive=64
root=HKLM
path=SOFTWARE\Intel\MediaSDK
delete_if_not_empty=no
condition=Is64
usequence=545
group=MSDK15

[Registry]
operation=deleteonuninstall
hive=64
root=HKLM
path=SOFTWARE\Intel
delete_if_not_empty=no
condition=Is64
usequence=550
group=MSDK15

; End Media SDK
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; These actions run on uninstall ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[Process]
operation=stoponuninstall
bin=GfxUI.exe
usequence=-13
group=GFX

[Process]
operation=stoponuninstall
bin=igfxtray.exe
usequence=-12
group=GFX

[Process]
operation=stoponuninstall
bin=igfxsrvc.exe
usequence=-11
group=GFX

[Process]
operation=stoponuninstall
bin=hkcmd.exe
usequence=-10
group=GFX

[Process]
operation=stoponuninstall
bin=igfxpers.exe
usequence=-9
group=GFX

[Process]
operation=stoponuninstall
bin=igfxext.exe
usequence=-8
group=GFX

[File]
operation=deleteo